___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Sensefuel",
  "categories": ["SALES", "ANALYTICS"],
  "brand": {
    "id": "brand_dummy",
    "displayName": {
      "text": "Official",
      "translations": [
        {
          "locale": "fr",
          "text": "Officiel"
        }
      ]
    },
    "thumbnail": "data:image/jpeg;base64,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\u003d\u003d"
  },
  "description": {
    "text": "Making ecommerce search personal.\nAssist your customers with AI hyper-personalized answers and engaging shopping experiences that promote sales.",
    "translations": [
      {
        "locale": "fr",
        "text": "Making ecommerce search personal.\nAssistez vos clients grâce à des réponses hyper-personnalisées par l\u0027IA, et des expériences d\u0027achats captivantes, qui stimulent la vente."
      }
    ]
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "gdpr",
    "displayName": {
      "text": "Tag Purpose",
      "translations": [
        {
          "locale": "fr",
          "text": "Objectif de la balise"
        }
      ]
    },
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "functional",
        "displayValue": {
          "text": "Functional",
          "translations": [
            {
              "locale": "fr",
              "text": "Fonctionnel"
            }
          ]
        }
      },
      {
        "value": "gdpr",
        "displayValue": {
          "text": "Multi-session",
          "translations": [
            {
              "locale": "fr",
              "text": "Multi-session"
            }
          ]
        }
      }
    ],
    "simpleValueType": true,
    "help": {
      "text": "Choose: Functional (does not required user\u0027s consent) or Multi-session (requires user\u0027s consent)",
      "translations": [
        {
          "locale": "fr",
          "text": "Choisissez : Fonctionnel (ne requiert pas de consentement utilisateur) ou Multi-session (requiert le consentement utilisateur)"
        }
      ]
    }
  },
  {
    "type": "TEXT",
    "name": "property_id",
    "displayName": {
      "text": "Parameter UID",
      "translations": [
        {
          "locale": "fr",
          "text": "Paramètre UID"
        }
      ]
    },
    "simpleValueType": true,
    "valueHint": "999d77-2c6d-8c5-a3d8-c2f9456bd8",
    "help": {
      "text": "Each functional tag has a UID parameter linked to a Sensefuel data environment.      eg: \n\u003cb\u003esrc \u003d \"https://tag.search.sensefuel.live/tag/99999d777-2c96d-88c5-a3d8-c2f95t456bd8/tagp.js\"\u003c/b\u003e/",
      "translations": [
        {
          "locale": "fr",
          "text": "Chaque tag fonctionnel possède un paramètre UID lié à un environnement de données Sensefuel. Ex:\n\u003cb\u003esrc \u003d \"https://tag.search.sensefuel.live/tag/99999d777-2c96d-88c5-a3d8-c2f95t456bd8/tagp.js\"\u003c/b\u003e/"
        }
      ]
    },
    "enablingConditions": [
      {
        "paramName": "gdpr",
        "paramValue": "functional",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "Other",
    "displayName": {
      "text": "Multiple environments",
      "translations": [
        {
          "locale": "fr",
          "text": "Environnements multiples"
        }
      ]
    },
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "add_custom_env",
        "checkboxText": {
          "text": "Parameters",
          "translations": [
            {
              "locale": "fr",
              "text": "Paramètres"
            }
          ]
        },
        "simpleValueType": true,
        "subParams": [
          {
            "type": "TEXT",
            "name": "property_id_multi",
            "displayName": {
              "text": "Input language code (lowercase)",
              "translations": [
                {
                  "locale": "fr",
                  "text": "Code de la langue d\u0027entrée (minuscule)"
                }
              ]
            },
            "simpleValueType": true,
            "valueHint": "en, fr, it, es, de ...",
            "enablingConditions": [
              {
                "paramName": "add_custom_env",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          },
          {
            "type": "SIMPLE_TABLE",
            "name": "dynamic_table",
            "displayName": {
              "text": "Mapping UIDs parameters",
              "translations": [
                {
                  "locale": "fr",
                  "text": "Cartographie des paramètres UIDs"
                }
              ]
            },
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": {
                  "text": "Language code",
                  "translations": [
                    {
                      "locale": "fr",
                      "text": "Code langue"
                    }
                  ]
                },
                "name": "code_language",
                "type": "SELECT",
                "selectItems": [
                  {
                    "value": "ar",
                    "displayValue": "ar - Arabic"
                  },
                  {
                    "value": "bg",
                    "displayValue": "bg - Bulgarian"
                  },
                  {
                    "value": "bs",
                    "displayValue": "bs - Bosnian"
                  },
                  {
                    "value": "cs",
                    "displayValue": "cs - Czech"
                  },
                  {
                    "value": "da",
                    "displayValue": "da - Danish"
                  },
                  {
                    "value": "de",
                    "displayValue": "de - German"
                  },
                  {
                    "value": "el",
                    "displayValue": "el - Greek"
                  },
                  {
                    "value": "en",
                    "displayValue": "en - English"
                  },
                  {
                    "value": "es",
                    "displayValue": "es - Spanish"
                  },
                  {
                    "value": "et",
                    "displayValue": "et - Estonian"
                  },
                  {
                    "value": "fi",
                    "displayValue": "fi - Finnish"
                  },
                  {
                    "value": "fr",
                    "displayValue": "fr - French"
                  },
                  {
                    "value": "ga",
                    "displayValue": "ga - Irish"
                  },
                  {
                    "value": "hr",
                    "displayValue": "hr - Croatian"
                  },
                  {
                    "value": "hu",
                    "displayValue": "hu - Hungarian"
                  },
                  {
                    "value": "it",
                    "displayValue": "it - Italian"
                  },
                  {
                    "value": "lt",
                    "displayValue": "lt - Lithuanian"
                  },
                  {
                    "value": "lv",
                    "displayValue": "lv - Latvian"
                  },
                  {
                    "value": "mt",
                    "displayValue": "mt - Maltese"
                  },
                  {
                    "value": "nl",
                    "displayValue": "nl - Dutch"
                  },
                  {
                    "value": "no",
                    "displayValue": "no - Norwegian"
                  },
                  {
                    "value": "pl",
                    "displayValue": "pl - Polish"
                  },
                  {
                    "value": "pt",
                    "displayValue": "pt - Portuguese"
                  },
                  {
                    "value": "ro",
                    "displayValue": "ro - Romanian"
                  },
                  {
                    "value": "ru",
                    "displayValue": "ru - Russian"
                  },
                  {
                    "value": "sk",
                    "displayValue": "sk - Slovak"
                  },
                  {
                    "value": "sl",
                    "displayValue": "sl - Slovenian"
                  },
                  {
                    "value": "sr",
                    "displayValue": "sr - Serbian"
                  },
                  {
                    "value": "sv",
                    "displayValue": "sv - Swedish"
                  },
                  {
                    "value": "tr",
                    "displayValue": "tr - Turkish"
                  },
                  {
                    "value": "uk",
                    "displayValue": "uk - Ukrainian"
                  },
                  {
                    "value": "zh",
                    "displayValue": "zh - Chinese (Simplified)"
                  }
                ],
                "isUnique": true
              },
              {
                "defaultValue": "",
                "displayName": {
                  "text": "Dynamic UID",
                  "translations": [
                    {
                      "locale": "fr",
                      "text": "UID dynamique"
                    }
                  ]
                },
                "name": "value",
                "type": "TEXT",
                "isUnique": true,
                "valueHint": "18-c2f95e036rrt8"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "add_custom_env",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "alwaysInSummary": false
          }
        ],
        "help": {
          "text": "Configure all your environments with a lookup table based on your UID parameters.",
          "translations": [
            {
              "locale": "fr",
              "text": "Configurez tous vos environnements à l’aide d’un tableau de correspondance (lookup table) en fonction de vos paramètres UID."
            }
          ]
        },
        "alwaysInSummary": true,
        "valueValidators": [],
        "enablingConditions": []
      }
    ],
    "enablingConditions": [
      {
        "paramName": "gdpr",
        "paramValue": "functional",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

/**
 * =====================================================
 * 🎯 OptimalWays & Sensefuel Integration - GTM Script
 * =====================================================
 * ✅ Optimized for Google Tag Manager
 * ✅ Clean, maintainable, and efficient code structure
 * 
 * 🛠️ Created by: Kahan N'GUESSAN - OptimalWays
 * 📅 Date: 20/06/2025 
 * =====================================================
 */

// Import required GTM functions
const log = require('logToConsole');
const injectScript = require('injectScript');
const encodeUri = require('encodeUri');

// Retrieve input data from the tag template configuration
const propertyId = encodeUri(data.property_id);
const customEnvironments = data.dynamic_table || [];
const chosenLanguage = data.property_id_multi;
const gdprTag = data.gdpr;


// Optional: Map of supported two-letter language codes to full names (currently not used)
const supportedLanguages = {
  ar: "Arabic",
  bg: "Bulgarian",
  bs: "Bosnian",
  cs: "Czech",
  da: "Danish",
  de: "German",
  el: "Greek",
  en: "English", 
  es: "Spanish", 
  et: "Estonian",
  fi: "Finnish",
  fr: "French", 
  ga: "Irish",
  hr: "Croatian",
  hu: "Hungarian",
  it: "Italian", 
  lt: "Lithuanian",
  lv: "Latvian",
  mt: "Maltese",
  nl: "Dutch", 
  no: "Norwegian",
  pl: "Polish",
  pt: "Portuguese",
  ro: "Romanian",
  ru: "Russian",
  sk: "Slovak",
  sl: "Slovenian",
  sr: "Serbian",
  sv: "Swedish",
  tr: "Turkish",
  uk: "Ukrainian",
  zh: "Chinese (Simplified)"
};



// Validate required field
if (!propertyId) {
  log("Ow debug ~ property_id manquant – arrêt du script");
  return data.gtmOnFailure();
}

// Build a mapping of language codes to environment values
const envMapping = {};
customEnvironments.forEach(item => {
  envMapping[item.code_language] = item.value;
});

// Determine the correct tracking URL with strict priority: GDPR > language > default
let trackingUrl;

if (gdprTag === 'gdpr') {
  trackingUrl = 'https://tag.search.sensefuel.live/tag/gdprstoragetag.js';
  log("Ow debug ~ GDPR mode activated. URL used :", trackingUrl);
} else if (envMapping[chosenLanguage]) {
  trackingUrl = "https://tag.search.sensefuel.live/tag/"+envMapping[chosenLanguage]+"/tagp.js";
  log("Ow debug ~ Language detected. URL used :", trackingUrl);
} else {
  trackingUrl = "https://tag.search.sensefuel.live/tag/"+propertyId+"/tagp.js";
  log("Ow debug ~ Default URL used :", trackingUrl);
}

// Inject the tracking script
injectScript(trackingUrl, data.gtmOnSuccess, data.gtmOnFailure, 'Sensefuel');


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://tag.search.sensefuel.live/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: gtmOnSuccess is invoked on injectScript success
  code: |-
    // test that gtmOnSuccess() is called when injectScript succeeds
    mock('injectScript', (url, onSuccess, onFailure) => {
      onSuccess();
    });

    // Call runCode to run the template's code.
    runCode();

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: gtmOnFailure is invoked when injectScript fails
  code: |-
    // test gtmOnFailure() is called when injectScript fails
    mock('injectScript', (url, onSuccess, onFailure) => {
      onFailure();
    });

    // Call runCode to run the template's code.
    runCode();

    // Verify onFailure was called
    assertApi('gtmOnFailure').wasCalled();
setup: ''


___NOTES___

Created on 6/26/2025, 6:01:32 PM


